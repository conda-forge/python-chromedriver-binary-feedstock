{% set version = "134.0.6983.0.0" %}
{% set python_min = python_min | default("3.9") %}

{% set chromedriver_version = version[:-2] %}

package:
  name: python-chromedriver-binary
  version: {{ version }}

source:
  - url: https://github.com/danielkaiser/python-chromedriver-binary/archive/v{{ version }}.tar.gz
    sha256: da0e63922d53a7d4eeab7e21caa67ad4b64fae23cf9524225fc594e2590787fa
  {% if noarch_platform == "linux" %}
  - url: https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/{{ chromedriver_version }}/linux64/chromedriver-linux64.zip
    sha256: 006e8d5e9b4930a52f9c41e405ef2163186cbfc1ed6e75576a17bf42d640b4b1
  {% elif noarch_platform == "osx" %}
  - url: https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/{{ chromedriver_version }}/mac-x64/chromedriver-mac-x64.zip
    sha256: adc302a21fecab0c209eb3cc8c690c56f07449a3a98efb831935cd2d34504935
  {% elif noarch_platform == "win" %}
  - url: https://edgedl.me.gvt1.com/edgedl/chrome/chrome-for-testing/{{ chromedriver_version }}/win32/chromedriver-win32.zip
    sha256: 6f06acb9fbc3688dbc0c2c4510c7c9a9ff0543f788145a2d398c9c688f39855e
  {% endif %}

build:
  number: 0
  noarch: python
  script:
    {% if noarch_platform in ["osx", "linux"] %}
    - chmod +x chromedriver
    {% endif %}
    - {{ PYTHON }} -m pip install . --no-deps --no-build-isolation -vv
  entry_points:
    - chromedriver-path = chromedriver_binary.utils:print_chromedriver_path
  {% if noarch_platform == "osx" %}
  binary_relocation: false
  {% endif %}

requirements:
  host:
    - pip
    - python {{ python_min }}
    - setuptools
  run:
    - __{{ noarch_platform }}
    - python >={{ python_min }}

test:
  requires:
    - pip
    - python {{ python_min }}
  imports:
    - chromedriver_binary
  commands:
    - pip check
    - chromedriver-path
    # TODO: investigate on linux, (at least) libxcb is missing...
    {% if noarch_platform == "osx" %}
    - $(chromedriver-path)/chromedriver --version
    {% endif %}

about:
  home: https://github.com/danielkaiser/python-chromedriver-binary
  license: MIT
  license_family: MIT
  license_file: LICENSE
  summary: Downloads and installs the chromedriver binary version
  description: |
    Downloads and installs the chromedriver binary for automated
    testing of webapps. The installer supports Linux, MacOS and Windows
    operating systems.

extra:
  recipe-maintainers:
    - williamjamir
    - bollwyvl
